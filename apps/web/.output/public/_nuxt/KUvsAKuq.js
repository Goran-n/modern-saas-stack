var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,"name",{value,configurable:!0});import{_ as __nuxt_component_0}from"./BdI7D7Kq.js";import{z as defineComponent,f as ref,A as onMounted,O as createElementBlock,a2 as createBaseVNode,X as createVNode,a5 as createCommentVNode,a3 as toDisplayString,G as unref,a4 as createTextVNode,W as withCtx,a6 as withModifiers,a7 as resolveComponent,P as openBlock}from"./BRSJK7Xo.js";import{b as useRouter,c as useSupabaseClient}from"./BGn8T2aB.js";import{_ as _sfc_main$4}from"./DIbFRL3M.js";import{_ as _sfc_main$3,a as _sfc_main$5}from"./HBRHWuMW.js";import{_ as _sfc_main$1}from"./DGo9Esvu.js";import{o as object,b as boolean,s as string,_ as _sfc_main$2,Z as ZodError}from"./DNtYPSZT.js";import{u as useAuthStore}from"./BzzzcPO6.js";import{u as useNotifications}from"./BzjSxxHY.js";import"./LqpTdS2-.js";import"./B8R4opHw.js";import"./DOQLo0N3.js";const _hoisted_1={class:"space-y-6"},_hoisted_2={class:"text-center"},_hoisted_3={class:"mt-2 text-sm text-slate-600"},_hoisted_4={key:0,class:"mt-3 inline-flex items-center px-3 py-1 rounded-full text-xs bg-blue-50 text-blue-700"},_hoisted_5={class:"flex items-center justify-between"},_hoisted_6={class:"text-center text-sm text-slate-500"},_sfc_main=defineComponent({__name:"login",setup(__props){const authStore=useAuthStore(),{auth,general}=useNotifications(),router=useRouter(),isLoading=ref(!1),errors=ref({}),isFromExtension=ref(!1),extensionCallbackUrl=ref(null);onMounted(()=>{const urlParams=new URLSearchParams(window.location.search);isFromExtension.value=urlParams.get("source")==="extension",extensionCallbackUrl.value=urlParams.get("callback"),isFromExtension.value});const schema=object({email:string().email("Invalid email address"),password:string().min(6,"Password must be at least 6 characters"),remember:boolean().default(!1)}),state=ref({email:"",password:"",remember:!1});function validateField(field){try{({email:string().email("Invalid email address"),password:string().min(6,"Password must be at least 6 characters"),remember:boolean()})[field].parse(state.value[field]),delete errors.value[field]}catch(error){error instanceof ZodError&&(errors.value[field]=error.issues[0]?.message||"Invalid input")}}__name(validateField,"validateField");function validateForm(){errors.value={};try{return schema.parse(state.value),!0}catch(error){return error instanceof ZodError&&error.issues.forEach(issue=>{issue.path[0]&&(errors.value[issue.path[0].toString()]=issue.message)}),!1}}__name(validateForm,"validateForm");async function onSubmit(){if(!validateForm())return;const formData=state.value;try{if(isLoading.value=!0,await authStore.signIn(formData.email,formData.password),auth.signInSuccess(),isFromExtension.value&&extensionCallbackUrl.value){general.success("Success!","Redirecting back to browser extension...");const supabaseClient=useSupabaseClient(),{data:sessionResponse}=await supabaseClient.auth.getSession(),currentSession=sessionResponse?.session,sessionData=currentSession?{access_token:currentSession.access_token,refresh_token:currentSession.refresh_token,expires_at:currentSession.expires_at,user:currentSession.user}:null;await new Promise(resolve=>setTimeout(resolve,1e3));const redirectUrl=`${extensionCallbackUrl.value}?auth_success=true&session=${encodeURIComponent(JSON.stringify(sessionData))}&timestamp=${Date.now()}`;window.location.href=redirectUrl}else await router.push("/")}catch(error){auth.signInFailed(error instanceof Error?error.message:void 0)}finally{isLoading.value=!1}}__name(onSubmit,"onSubmit");async function signInWithProvider(){try{general.comingSoon("Google sign-in")}catch(error){general.error("Error",error instanceof Error?error.message:void 0)}}return __name(signInWithProvider,"signInWithProvider"),(_ctx,_cache)=>{const _component_NuxtLink=__nuxt_component_0,_component_NuxtIcon=resolveComponent("NuxtIcon");return openBlock(),createElementBlock("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[_cache[6]||(_cache[6]=createBaseVNode("h1",{class:"text-2xl font-semibold text-slate-900"}," Welcome back ",-1)),createBaseVNode("p",_hoisted_3,toDisplayString(unref(isFromExtension)?"Sign in to enable browser extension features":"Sign in to continue to Figgy"),1),unref(isFromExtension)?(openBlock(),createElementBlock("div",_hoisted_4,_cache[5]||(_cache[5]=[createBaseVNode("svg",{class:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20"},[createBaseVNode("path",{d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),createTextVNode(" Browser Extension Login ",-1)]))):createCommentVNode("",!0)]),createBaseVNode("form",{onSubmit:withModifiers(onSubmit,["prevent"]),class:"space-y-4"},[createVNode(unref(_sfc_main$2),{label:"Email",error:unref(errors).email,required:""},{default:withCtx(()=>[createVNode(unref(_sfc_main$1),{modelValue:unref(state).email,"onUpdate:modelValue":_cache[0]||(_cache[0]=$event=>unref(state).email=$event),type:"email",placeholder:"Enter your email",size:"lg",autofocus:"",onBlur:_cache[1]||(_cache[1]=$event=>validateField("email"))},null,8,["modelValue"])]),_:1},8,["error"]),createVNode(unref(_sfc_main$2),{label:"Password",error:unref(errors).password,required:""},{default:withCtx(()=>[createVNode(unref(_sfc_main$1),{modelValue:unref(state).password,"onUpdate:modelValue":_cache[2]||(_cache[2]=$event=>unref(state).password=$event),type:"password",placeholder:"Enter your password",size:"lg",onBlur:_cache[3]||(_cache[3]=$event=>validateField("password"))},null,8,["modelValue"])]),_:1},8,["error"]),createBaseVNode("div",_hoisted_5,[createVNode(unref(_sfc_main$3),{modelValue:unref(state).remember,"onUpdate:modelValue":_cache[4]||(_cache[4]=$event=>unref(state).remember=$event),label:"Remember me"},null,8,["modelValue"]),createVNode(_component_NuxtLink,{to:"/auth/forgot-password",class:"text-sm text-primary-600 hover:text-primary-700 font-medium"},{default:withCtx(()=>_cache[7]||(_cache[7]=[createTextVNode(" Forgot password? ",-1)])),_:1,__:[7]})]),createVNode(unref(_sfc_main$4),{type:"submit",class:"w-full",size:"lg",loading:unref(isLoading)},{default:withCtx(()=>_cache[8]||(_cache[8]=[createTextVNode(" Sign In ",-1)])),_:1,__:[8]},8,["loading"])],32),createVNode(unref(_sfc_main$5),{label:"or continue with",class:"my-6"}),createVNode(unref(_sfc_main$4),{class:"w-full",size:"lg",color:"neutral",variant:"outline",onClick:signInWithProvider},{default:withCtx(()=>[createVNode(_component_NuxtIcon,{name:"simple-icons:google",class:"w-4 h-4 mr-2"}),_cache[9]||(_cache[9]=createTextVNode(" Continue with Google ",-1))]),_:1,__:[9]}),createBaseVNode("p",_hoisted_6,[_cache[11]||(_cache[11]=createTextVNode(" New to Figgy? ",-1)),createVNode(_component_NuxtLink,{to:"/auth/signup",class:"font-medium text-primary-600 hover:text-primary-700"},{default:withCtx(()=>_cache[10]||(_cache[10]=[createTextVNode(" Create an account ",-1)])),_:1,__:[10]})])])}}});export{_sfc_main as default};
