var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,"name",{value,configurable:!0});import{u as useCommunicationStore}from"./BvRDyO_j.js";import{e as useTenantStore,i as useSeoMeta,n as navigateTo}from"./BGn8T2aB.js";import{_ as _sfc_main$2}from"./CEfzLdwR.js";import{_ as _sfc_main$3}from"./BeaoTUGu.js";import{_ as _sfc_main$1}from"./B8fQSm5j.js";import{u as useNotification}from"./Dr_osDAG.js";import{z as defineComponent,f as ref,E as computed,A as onMounted,O as createElementBlock,X as createVNode,W as withCtx,G as unref,a7 as resolveComponent,P as openBlock,a2 as createBaseVNode,a3 as toDisplayString,V as createBlock,a4 as createTextVNode,L as Fragment,a8 as renderList,a5 as createCommentVNode,U as normalizeClass}from"./BRSJK7Xo.js";import"./Cw4ufSzG.js";import"./BzzzcPO6.js";import"./BzjSxxHY.js";import"./DOQLo0N3.js";import"./B8R4opHw.js";const _hoisted_1={class:"min-h-screen bg-neutral-50"},_hoisted_2={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8"},_hoisted_3={class:"flex items-center justify-between"},_hoisted_4={class:"mt-1 text-2xl font-semibold text-gray-900"},_hoisted_5={class:"p-3 bg-primary-50 rounded-lg"},_hoisted_6={class:"mt-4 flex items-center text-sm"},_hoisted_7={class:"ml-1 font-medium"},_hoisted_8={class:"ml-1 font-medium"},_hoisted_9={class:"flex items-center justify-between"},_hoisted_10={class:"mt-1 text-2xl font-semibold text-gray-900"},_hoisted_11={class:"p-3 bg-green-50 rounded-lg"},_hoisted_12={class:"mt-4"},_hoisted_13={class:"flex items-center justify-between"},_hoisted_14={class:"mt-1 text-2xl font-semibold text-gray-900"},_hoisted_15={class:"p-3 bg-red-50 rounded-lg"},_hoisted_16={class:"mt-4"},_hoisted_17={key:1,class:"text-xs text-gray-600"},_hoisted_18={class:"flex items-center justify-between"},_hoisted_19={class:"mt-1 text-2xl font-semibold text-gray-900"},_hoisted_20={class:"p-3 bg-yellow-50 rounded-lg"},_hoisted_21={class:"mt-4"},_hoisted_22={key:1,class:"text-xs text-gray-600"},_hoisted_23={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},_hoisted_24={class:"lg:col-span-2"},_hoisted_25={class:"flex items-center justify-between"},_hoisted_26={key:0,class:"space-y-3"},_hoisted_27={class:"flex-shrink-0"},_hoisted_28={class:"flex-1 min-w-0"},_hoisted_29={class:"text-sm font-medium text-gray-900"},_hoisted_30={class:"mt-1 flex items-center space-x-3"},_hoisted_31={class:"text-xs text-gray-500"},_hoisted_32={key:0,class:"flex-shrink-0"},_hoisted_33={key:1,class:"text-center py-8"},_hoisted_34={class:"space-y-4"},_hoisted_35={class:"space-y-3"},_hoisted_36={class:"space-y-3"},_hoisted_37={class:"flex items-center justify-between"},_hoisted_38={class:"flex items-center space-x-2"},_hoisted_39={class:"flex items-center justify-between"},_hoisted_40={class:"flex items-center space-x-2"},_sfc_main=defineComponent({__name:"index",setup(__props){const communicationStore=useCommunicationStore(),tenantStore=useTenantStore(),isRefreshing=ref(!1),stats=computed(()=>communicationStore.stats),recentActivity=computed(()=>communicationStore.recentActivity.slice(0,10)),failedCount=computed(()=>communicationStore.failedActivities.length),workspaceCount=computed(()=>communicationStore.activeWorkspaces.length);onMounted(async()=>{if(tenantStore.selectedTenantId||await tenantStore.fetchUserTenants(),!tenantStore.selectedTenantId){useNotification().error("No tenant selected","Please select a tenant to view communications.");return}try{await Promise.all([communicationStore.fetchStats(),communicationStore.fetchRecentActivity(),communicationStore.fetchWorkspaces()])}catch{useNotification().error("Failed to load data","Unable to load communication data. Please try again.")}});const refreshActivity=__name(async()=>{isRefreshing.value=!0;try{await communicationStore.fetchRecentActivity()}finally{isRefreshing.value=!1}},"refreshActivity"),retryActivity=__name(async activityId=>{try{await communicationStore.retryFailedProcessing(activityId),useNotification().success("Retry initiated","Processing has been restarted")}catch{useNotification().error("Retry failed","Could not restart processing")}},"retryActivity"),retryAllFailed=__name(async()=>{useNotification().info("Retrying all failed items",`Processing ${failedCount.value} items`)},"retryAllFailed"),showFailedItems=__name(()=>{navigateTo("/communications/failed")},"showFailedItems"),downloadActivityLog=__name(()=>{useNotification().info("Preparing download","Your activity log will download shortly")},"downloadActivityLog"),getPlatformIcon=__name(platform=>platform==="whatsapp"?"i-simple-icons-whatsapp":"i-simple-icons-slack","getPlatformIcon"),getPlatformIconClass=__name(platform=>platform==="whatsapp"?"bg-green-100 text-green-600":"bg-purple-100 text-purple-600","getPlatformIconClass"),formatRelativeTime=__name(timestamp=>{const date=new Date(timestamp),diff=new Date().getTime()-date.getTime(),minutes=Math.floor(diff/6e4);if(minutes<1)return"just now";if(minutes<60)return`${minutes}m ago`;const hours=Math.floor(minutes/60);return hours<24?`${hours}h ago`:`${Math.floor(hours/24)}d ago`},"formatRelativeTime");return useSeoMeta({title:"Communications | Figgy",description:"Monitor WhatsApp and Slack message processing and file handling"}),(_ctx,_cache)=>{const _component_UIcon=resolveComponent("UIcon"),_component_UCard=resolveComponent("UCard"),_component_UProgress=resolveComponent("UProgress"),_component_UButton=resolveComponent("UButton"),_component_UAvatar=resolveComponent("UAvatar");return openBlock(),createElementBlock("div",_hoisted_1,[createVNode(unref(_sfc_main$3),{"max-width":"6xl",class:"py-8"},{default:withCtx(()=>[_cache[18]||(_cache[18]=createBaseVNode("div",{class:"mb-6"},[createBaseVNode("h1",{class:"text-2xl font-semibold text-gray-900"},"Communications"),createBaseVNode("p",{class:"mt-1 text-sm text-gray-600"}," Monitor WhatsApp and Slack message processing ")],-1)),createBaseVNode("div",_hoisted_2,[createVNode(_component_UCard,null,{default:withCtx(()=>[createBaseVNode("div",_hoisted_3,[createBaseVNode("div",null,[_cache[0]||(_cache[0]=createBaseVNode("p",{class:"text-sm font-medium text-gray-600"},"Total Messages",-1)),createBaseVNode("p",_hoisted_4,toDisplayString(unref(stats).totalMessages.toLocaleString()),1)]),createBaseVNode("div",_hoisted_5,[createVNode(_component_UIcon,{name:"i-heroicons-chat-bubble-left-right",class:"w-6 h-6 text-primary-600"})])]),createBaseVNode("div",_hoisted_6,[_cache[1]||(_cache[1]=createBaseVNode("span",{class:"text-gray-600"},"WhatsApp:",-1)),createBaseVNode("span",_hoisted_7,toDisplayString(unref(stats).whatsappMessages),1),_cache[2]||(_cache[2]=createBaseVNode("span",{class:"ml-3 text-gray-600"},"Slack:",-1)),createBaseVNode("span",_hoisted_8,toDisplayString(unref(stats).slackMessages),1)])]),_:1}),createVNode(_component_UCard,null,{default:withCtx(()=>[createBaseVNode("div",_hoisted_9,[createBaseVNode("div",null,[_cache[3]||(_cache[3]=createBaseVNode("p",{class:"text-sm font-medium text-gray-600"},"Files Today",-1)),createBaseVNode("p",_hoisted_10,toDisplayString(unref(stats).filesProcessedToday),1)]),createBaseVNode("div",_hoisted_11,[createVNode(_component_UIcon,{name:"i-heroicons-document-check",class:"w-6 h-6 text-green-600"})])]),createBaseVNode("div",_hoisted_12,[createVNode(_component_UProgress,{value:75,color:"success",size:"sm"}),_cache[4]||(_cache[4]=createBaseVNode("p",{class:"mt-1 text-xs text-gray-600"},"Processing rate",-1))])]),_:1}),createVNode(_component_UCard,null,{default:withCtx(()=>[createBaseVNode("div",_hoisted_13,[createBaseVNode("div",null,[_cache[5]||(_cache[5]=createBaseVNode("p",{class:"text-sm font-medium text-gray-600"},"Failed Processing",-1)),createBaseVNode("p",_hoisted_14,toDisplayString(unref(stats).failedProcessing),1)]),createBaseVNode("div",_hoisted_15,[createVNode(_component_UIcon,{name:"i-heroicons-exclamation-triangle",class:"w-6 h-6 text-red-600"})])]),createBaseVNode("div",_hoisted_16,[unref(stats).failedProcessing>0?(openBlock(),createBlock(_component_UButton,{key:0,size:"xs",variant:"soft",color:"error",onClick:showFailedItems},{default:withCtx(()=>_cache[6]||(_cache[6]=[createTextVNode(" View Failed ",-1)])),_:1,__:[6]})):(openBlock(),createElementBlock("span",_hoisted_17,"All clear"))])]),_:1}),createVNode(_component_UCard,null,{default:withCtx(()=>[createBaseVNode("div",_hoisted_18,[createBaseVNode("div",null,[_cache[7]||(_cache[7]=createBaseVNode("p",{class:"text-sm font-medium text-gray-600"},"Pending Verifications",-1)),createBaseVNode("p",_hoisted_19,toDisplayString(unref(stats).pendingVerifications),1)]),createBaseVNode("div",_hoisted_20,[createVNode(_component_UIcon,{name:"i-heroicons-shield-check",class:"w-6 h-6 text-yellow-600"})])]),createBaseVNode("div",_hoisted_21,[unref(stats).pendingVerifications>0?(openBlock(),createBlock(_component_UButton,{key:0,size:"xs",variant:"soft",color:"warning",to:"/communications/whatsapp/verifications"},{default:withCtx(()=>_cache[8]||(_cache[8]=[createTextVNode(" Manage ",-1)])),_:1,__:[8]})):(openBlock(),createElementBlock("span",_hoisted_22,"None pending"))])]),_:1})]),createBaseVNode("div",_hoisted_23,[createBaseVNode("div",_hoisted_24,[createVNode(_component_UCard,null,{header:withCtx(()=>[createBaseVNode("div",_hoisted_25,[_cache[9]||(_cache[9]=createBaseVNode("h2",{class:"text-lg font-semibold text-gray-900"},"Recent Activity",-1)),createVNode(_component_UButton,{icon:"i-heroicons-arrow-path",size:"xs",variant:"ghost",loading:unref(isRefreshing),onClick:refreshActivity},null,8,["loading"])])]),default:withCtx(()=>[unref(recentActivity).length>0?(openBlock(),createElementBlock("div",_hoisted_26,[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(recentActivity),activity=>(openBlock(),createElementBlock("div",{key:activity.id,class:"flex items-start space-x-3 p-3 rounded-lg hover:bg-gray-50 transition-colors"},[createBaseVNode("div",_hoisted_27,[createBaseVNode("div",{class:normalizeClass(["w-10 h-10 rounded-full flex items-center justify-center",getPlatformIconClass(activity.platform)])},[createVNode(_component_UIcon,{name:getPlatformIcon(activity.platform),class:"w-5 h-5"},null,8,["name"])],2)]),createBaseVNode("div",_hoisted_28,[createBaseVNode("p",_hoisted_29,toDisplayString(activity.description),1),createBaseVNode("div",_hoisted_30,[createVNode(unref(_sfc_main$1),{status:activity.status,type:"processing",variant:"soft",size:"xs"},null,8,["status"]),createBaseVNode("span",_hoisted_31,toDisplayString(formatRelativeTime(activity.timestamp)),1)])]),activity.status==="failed"?(openBlock(),createElementBlock("div",_hoisted_32,[createVNode(_component_UButton,{icon:"i-heroicons-arrow-path",size:"xs",variant:"ghost",color:"error",onClick:__name($event=>retryActivity(activity.id),"onClick")},null,8,["onClick"])])):createCommentVNode("",!0)]))),128))])):(openBlock(),createElementBlock("div",_hoisted_33,[createVNode(_component_UIcon,{name:"i-heroicons-inbox",class:"w-12 h-12 text-gray-400 mx-auto mb-3"}),_cache[10]||(_cache[10]=createBaseVNode("p",{class:"text-sm text-gray-500"},"No recent activity",-1))]))]),_:1})]),createBaseVNode("div",_hoisted_34,[createVNode(_component_UCard,null,{header:withCtx(()=>_cache[11]||(_cache[11]=[createBaseVNode("h2",{class:"text-lg font-semibold text-gray-900"},"Quick Actions",-1)])),default:withCtx(()=>[createBaseVNode("div",_hoisted_35,[createVNode(_component_UButton,{block:"",variant:"soft",icon:"i-heroicons-shield-check",to:"/communications/whatsapp/verifications"},{default:withCtx(()=>_cache[12]||(_cache[12]=[createTextVNode(" Manage Verifications ",-1)])),_:1,__:[12]}),createVNode(_component_UButton,{block:"",variant:"soft",icon:"i-heroicons-building-office",to:"/communications/slack/workspaces"},{default:withCtx(()=>_cache[13]||(_cache[13]=[createTextVNode(" Slack Workspaces ",-1)])),_:1,__:[13]}),createVNode(_component_UButton,{block:"",variant:"soft",icon:"i-heroicons-arrow-path",onClick:retryAllFailed,disabled:unref(failedCount)===0},{default:withCtx(()=>[createTextVNode(" Retry All Failed ("+toDisplayString(unref(failedCount))+") ",1)]),_:1},8,["disabled"]),createVNode(_component_UButton,{block:"",variant:"soft",icon:"i-heroicons-arrow-down-tray",onClick:downloadActivityLog},{default:withCtx(()=>_cache[14]||(_cache[14]=[createTextVNode(" Download Activity Log ",-1)])),_:1,__:[14]})])]),_:1}),createVNode(_component_UCard,null,{header:withCtx(()=>_cache[15]||(_cache[15]=[createBaseVNode("h2",{class:"text-lg font-semibold text-gray-900"},"Platform Status",-1)])),default:withCtx(()=>[createBaseVNode("div",_hoisted_36,[createBaseVNode("div",_hoisted_37,[createBaseVNode("div",_hoisted_38,[createVNode(_component_UAvatar,{size:"sm",class:"bg-green-100"},{default:withCtx(()=>[createVNode(_component_UIcon,{name:"i-simple-icons-whatsapp",class:"text-green-600"})]),_:1}),_cache[16]||(_cache[16]=createBaseVNode("span",{class:"text-sm font-medium"},"WhatsApp",-1))]),createVNode(unref(_sfc_main$1),{status:"connected",type:"connection",variant:"soft",size:"xs"})]),createBaseVNode("div",_hoisted_39,[createBaseVNode("div",_hoisted_40,[createVNode(_component_UAvatar,{size:"sm",class:"bg-purple-100"},{default:withCtx(()=>[createVNode(_component_UIcon,{name:"i-simple-icons-slack",class:"text-purple-600"})]),_:1}),_cache[17]||(_cache[17]=createBaseVNode("span",{class:"text-sm font-medium"},"Slack",-1))]),createVNode(unref(_sfc_main$2),{color:unref(workspaceCount)>0?"success":"neutral",variant:"soft",size:"xs"},{default:withCtx(()=>[createTextVNode(toDisplayString(unref(workspaceCount)>0?`${unref(workspaceCount)} workspaces`:"Not configured"),1)]),_:1},8,["color"])])])]),_:1})])])]),_:1,__:[18]})])}}});export{_sfc_main as default};
