var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,"name",{value,configurable:!0});import{z as defineComponent,E as computed,f as ref,A as onMounted,O as createElementBlock,X as createVNode,W as withCtx,G as unref,M as useRoute,a7 as resolveComponent,P as openBlock,a2 as createBaseVNode,a3 as toDisplayString,a4 as createTextVNode,d as isRef,V as createBlock,a5 as createCommentVNode}from"./BRSJK7Xo.js";import{n as navigateTo,i as useSeoMeta}from"./BGn8T2aB.js";import{_ as _sfc_main$3}from"./BeaoTUGu.js";import{_ as _sfc_main$1}from"./B8fQSm5j.js";import{_ as _sfc_main$2}from"./DUt60K_l.js";import{u as useNotification}from"./Dr_osDAG.js";import"./CEfzLdwR.js";import"./B8R4opHw.js";import"./DIbFRL3M.js";import"./LqpTdS2-.js";import"./DOQLo0N3.js";const _hoisted_1={class:"min-h-screen bg-neutral-50"},_hoisted_2={class:"mb-6"},_hoisted_3={class:"flex items-center justify-between"},_hoisted_4={class:"mt-1 text-sm text-gray-600"},_hoisted_5={class:"flex items-center gap-3"},_hoisted_6={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},_hoisted_7={class:"text-center"},_hoisted_8={class:"text-2xl font-semibold text-gray-900"},_hoisted_9={class:"text-center"},_hoisted_10={class:"text-2xl font-semibold text-green-600"},_hoisted_11={class:"text-center"},_hoisted_12={class:"text-2xl font-semibold text-yellow-600"},_hoisted_13={class:"text-center"},_hoisted_14={class:"text-2xl font-semibold text-gray-900"},_hoisted_15={class:"flex flex-col md:flex-row gap-4"},_hoisted_16={class:"flex items-center gap-3"},_hoisted_17={class:"font-medium text-gray-900"},_hoisted_18={class:"text-xs text-gray-500"},_hoisted_19={class:"px-2 py-1 bg-gray-100 rounded text-xs"},_hoisted_20={key:0,class:"flex items-center gap-2"},_hoisted_21={class:"text-sm"},_hoisted_22={key:1,class:"flex items-center gap-2"},_hoisted_23={class:"text-sm text-gray-600"},_hoisted_24={class:"flex items-center gap-2"},_hoisted_25={class:"mt-4 flex items-center justify-between"},_hoisted_26={class:"text-sm text-gray-600"},_hoisted_27={class:"space-y-4"},_hoisted_28={class:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg"},_hoisted_29={class:"font-medium"},_hoisted_30={class:"text-sm text-gray-600"},_hoisted_31={class:"space-y-2"},_hoisted_32={class:"flex justify-end gap-3 pt-4"},pageSize=20,_sfc_main=defineComponent({__name:"users",setup(__props){const route=useRoute(),workspaceId=computed(()=>route.query.workspace),workspaceName=ref("Workspace");onMounted(async()=>{if(!workspaceId.value){await navigateTo("/communications/slack/workspaces");return}isLoading.value=!0,isLoading.value=!1});const isLoading=ref(!1),isRefreshing=ref(!1),isSaving=ref(!1),showMapModal=ref(!1),selectedUser=ref(null),searchQuery=ref(""),statusFilter=ref("all"),mappingFilter=ref("all"),page=ref(1),mappingForm=ref({userId:"",canRead:!0,canWrite:!0,canManage:!1}),users=ref([]),systemUsers=ref([]),statusOptions=[{label:"All",value:"all"},{label:"Active",value:"active"},{label:"Inactive",value:"inactive"}],mappingOptions=[{label:"All",value:"all"},{label:"Mapped",value:"mapped"},{label:"Unmapped",value:"unmapped"}],columns=[{id:"user",key:"user",label:"User",sortable:!0},{id:"slackId",key:"slackId",label:"Slack ID"},{id:"status",key:"status",label:"Status",sortable:!0},{id:"mapping",key:"mapping",label:"Mapping"},{id:"lastActive",key:"lastActive",label:"Last Active",sortable:!0},{id:"actions",key:"actions",label:"Actions"}],filteredUsers=computed(()=>{let filtered=users.value;if(searchQuery.value){const query=searchQuery.value.toLowerCase();filtered=filtered.filter(u=>u.displayName.toLowerCase().includes(query)||u.email?.toLowerCase().includes(query)||u.slackId.toLowerCase().includes(query))}return statusFilter.value!=="all"&&(filtered=filtered.filter(u=>statusFilter.value==="active"?u.isActive:!u.isActive)),mappingFilter.value!=="all"&&(filtered=filtered.filter(u=>mappingFilter.value==="mapped"?u.mappedUserId:!u.mappedUserId)),filtered}),startIndex=computed(()=>(page.value-1)*pageSize),endIndex=computed(()=>Math.min(startIndex.value+pageSize,filteredUsers.value.length)),mappedCount=computed(()=>users.value.filter(u=>u.mappedUserId).length),unmappedCount=computed(()=>users.value.filter(u=>!u.mappedUserId).length),activeCount=computed(()=>users.value.filter(u=>u.isActive).length),breadcrumbs=[{label:"Communications",to:"/communications"},{label:"Slack",to:"/communications/slack"},{label:"Workspaces",to:"/communications/slack/workspaces"},{label:"Users"}],refresh=__name(async()=>{isRefreshing.value=!0;try{await new Promise(resolve=>setTimeout(resolve,1e3)),useNotification().success("Data refreshed")}catch(error){useNotification().error("Failed to refresh data",error instanceof Error?error.message:"Unknown error occurred")}finally{isRefreshing.value=!1}},"refresh"),syncUsers=__name(async()=>{try{await new Promise(resolve=>setTimeout(resolve,2e3)),useNotification().success("Users synced","Successfully synced users from Slack")}catch(error){useNotification().error("Sync failed",error instanceof Error?error.message:"Could not sync users from Slack")}},"syncUsers"),clearFilters=__name(()=>{searchQuery.value="",statusFilter.value="all",mappingFilter.value="all",page.value=1},"clearFilters"),mapUser=__name(user=>{selectedUser.value=user,mappingForm.value={userId:"",canRead:!0,canWrite:!0,canManage:!1},showMapModal.value=!0},"mapUser"),unmapUser=__name(async user=>{if(confirm(`Remove mapping for ${user.displayName}?`))try{await new Promise(resolve=>setTimeout(resolve,500)),user.mappedUserId=void 0,user.mappedUserName=void 0,useNotification().success("User unmapped","User mapping has been removed")}catch(error){useNotification().error("Failed to unmap user",error instanceof Error?error.message:"Unknown error occurred")}},"unmapUser"),saveMapping=__name(async()=>{isSaving.value=!0;try{if(await new Promise(resolve=>setTimeout(resolve,1e3)),selectedUser.value){const systemUser=systemUsers.value.find(u=>u.value===mappingForm.value.userId);systemUser&&(selectedUser.value.mappedUserId=mappingForm.value.userId,selectedUser.value.mappedUserName=systemUser.label)}useNotification().success("User mapped","Slack user has been mapped successfully"),showMapModal.value=!1}catch(error){useNotification().error("Mapping failed",error instanceof Error?error.message:"Could not map the user")}finally{isSaving.value=!1}},"saveMapping"),getActionItems=__name(user=>[[{label:"View Details",icon:"i-heroicons-eye",click:__name(()=>viewUserDetails(),"click")}],[{label:"View Messages",icon:"i-heroicons-chat-bubble-left-right",click:__name(()=>viewUserMessages(user),"click")}],[{label:user.isActive?"Deactivate":"Activate",icon:user.isActive?"i-heroicons-x-circle":"i-heroicons-check-circle",click:__name(()=>toggleUserStatus(user),"click")}]],"getActionItems"),viewUserDetails=__name(_user=>{},"viewUserDetails"),viewUserMessages=__name(user=>{navigateTo(`/communications/messages?user=${user.slackId}`)},"viewUserMessages"),toggleUserStatus=__name(async user=>{try{await new Promise(resolve=>setTimeout(resolve,500)),user.isActive=!user.isActive,useNotification().success(user.isActive?"User activated":"User deactivated",`${user.displayName} has been ${user.isActive?"activated":"deactivated"}`)}catch(error){useNotification().error("Status update failed",error instanceof Error?error.message:"Unknown error occurred")}},"toggleUserStatus"),formatRelativeTime=__name(timestamp=>{const date=new Date(timestamp),diff=new Date().getTime()-date.getTime(),minutes=Math.floor(diff/6e4);if(minutes<1)return"just now";if(minutes<60)return`${minutes}m ago`;const hours=Math.floor(minutes/60);return hours<24?`${hours}h ago`:`${Math.floor(hours/24)}d ago`},"formatRelativeTime");return useSeoMeta({title:"Slack Users | Figgy",description:"Manage Slack user mappings and permissions"}),(_ctx,_cache)=>{const _component_UBreadcrumb=resolveComponent("UBreadcrumb"),_component_UButton=resolveComponent("UButton"),_component_UCard=resolveComponent("UCard"),_component_UInput=resolveComponent("UInput"),_component_USelectMenu=resolveComponent("USelectMenu"),_component_UAvatar=resolveComponent("UAvatar"),_component_UIcon=resolveComponent("UIcon"),_component_UDropdownMenu=resolveComponent("UDropdownMenu"),_component_UTable=resolveComponent("UTable"),_component_UPagination=resolveComponent("UPagination"),_component_UFormField=resolveComponent("UFormField"),_component_UCheckbox=resolveComponent("UCheckbox");return openBlock(),createElementBlock("div",_hoisted_1,[createVNode(unref(_sfc_main$3),{"max-width":"6xl",class:"py-8"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_2,[createVNode(_component_UBreadcrumb,{links:breadcrumbs,class:"mb-4"}),createBaseVNode("div",_hoisted_3,[createBaseVNode("div",null,[_cache[10]||(_cache[10]=createBaseVNode("h1",{class:"text-2xl font-semibold text-gray-900"},"Slack Users",-1)),createBaseVNode("p",_hoisted_4," Manage user mappings and permissions for "+toDisplayString(unref(workspaceName)),1)]),createBaseVNode("div",_hoisted_5,[createVNode(_component_UButton,{icon:"i-heroicons-arrow-path",variant:"soft",onClick:refresh,loading:unref(isRefreshing)},{default:withCtx(()=>_cache[11]||(_cache[11]=[createTextVNode(" Refresh ",-1)])),_:1,__:[11]},8,["loading"]),createVNode(_component_UButton,{icon:"i-heroicons-arrow-down-tray",variant:"soft",onClick:syncUsers},{default:withCtx(()=>_cache[12]||(_cache[12]=[createTextVNode(" Sync from Slack ",-1)])),_:1,__:[12]})])])]),createBaseVNode("div",_hoisted_6,[createVNode(_component_UCard,null,{default:withCtx(()=>[createBaseVNode("div",_hoisted_7,[createBaseVNode("p",_hoisted_8,toDisplayString(unref(users).length),1),_cache[13]||(_cache[13]=createBaseVNode("p",{class:"text-sm text-gray-600 mt-1"},"Total Users",-1))])]),_:1}),createVNode(_component_UCard,null,{default:withCtx(()=>[createBaseVNode("div",_hoisted_9,[createBaseVNode("p",_hoisted_10,toDisplayString(unref(mappedCount)),1),_cache[14]||(_cache[14]=createBaseVNode("p",{class:"text-sm text-gray-600 mt-1"},"Mapped",-1))])]),_:1}),createVNode(_component_UCard,null,{default:withCtx(()=>[createBaseVNode("div",_hoisted_11,[createBaseVNode("p",_hoisted_12,toDisplayString(unref(unmappedCount)),1),_cache[15]||(_cache[15]=createBaseVNode("p",{class:"text-sm text-gray-600 mt-1"},"Unmapped",-1))])]),_:1}),createVNode(_component_UCard,null,{default:withCtx(()=>[createBaseVNode("div",_hoisted_13,[createBaseVNode("p",_hoisted_14,toDisplayString(unref(activeCount)),1),_cache[16]||(_cache[16]=createBaseVNode("p",{class:"text-sm text-gray-600 mt-1"},"Active",-1))])]),_:1})]),createVNode(_component_UCard,{class:"mb-6"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_15,[createVNode(_component_UInput,{modelValue:unref(searchQuery),"onUpdate:modelValue":_cache[0]||(_cache[0]=$event=>isRef(searchQuery)?searchQuery.value=$event:null),placeholder:"Search by name or email...",icon:"i-heroicons-magnifying-glass",class:"flex-1"},null,8,["modelValue"]),createVNode(_component_USelectMenu,{modelValue:unref(statusFilter),"onUpdate:modelValue":_cache[1]||(_cache[1]=$event=>isRef(statusFilter)?statusFilter.value=$event:null),options:statusOptions,placeholder:"Filter by status",class:"w-full md:w-48"},null,8,["modelValue"]),createVNode(_component_USelectMenu,{modelValue:unref(mappingFilter),"onUpdate:modelValue":_cache[2]||(_cache[2]=$event=>isRef(mappingFilter)?mappingFilter.value=$event:null),options:mappingOptions,placeholder:"Filter by mapping",class:"w-full md:w-48"},null,8,["modelValue"]),createVNode(_component_UButton,{variant:"soft",icon:"i-heroicons-funnel",onClick:clearFilters,disabled:!unref(searchQuery)&&unref(statusFilter)==="all"&&unref(mappingFilter)==="all"},{default:withCtx(()=>_cache[17]||(_cache[17]=[createTextVNode(" Clear ",-1)])),_:1,__:[17]},8,["disabled"])])]),_:1}),createVNode(_component_UCard,null,{default:withCtx(()=>[createVNode(_component_UTable,{columns,rows:unref(filteredUsers),loading:unref(isLoading),"empty-state":{icon:"i-heroicons-users",label:"No users found"}},{"user-data":withCtx(({row})=>[createBaseVNode("div",_hoisted_16,[createVNode(_component_UAvatar,{src:row.avatar,alt:row.displayName,size:"sm"},null,8,["src","alt"]),createBaseVNode("div",null,[createBaseVNode("p",_hoisted_17,toDisplayString(row.displayName),1),createBaseVNode("p",_hoisted_18,toDisplayString(row.email||"No email"),1)])])]),"slackId-data":withCtx(({row})=>[createBaseVNode("code",_hoisted_19,toDisplayString(row.slackId),1)]),"status-data":withCtx(({row})=>[createVNode(unref(_sfc_main$1),{status:row.isActive?"active":"inactive",type:"connection",variant:"soft",size:"xs"},null,8,["status"])]),"mapping-data":withCtx(({row})=>[row.mappedUserId?(openBlock(),createElementBlock("div",_hoisted_20,[createVNode(_component_UIcon,{name:"i-heroicons-link",class:"text-green-500"}),createBaseVNode("span",_hoisted_21,toDisplayString(row.mappedUserName),1)])):(openBlock(),createElementBlock("div",_hoisted_22,[createVNode(_component_UIcon,{name:"i-heroicons-link-slash",class:"text-gray-400"}),_cache[18]||(_cache[18]=createBaseVNode("span",{class:"text-sm text-gray-500"},"Not mapped",-1))]))]),"lastActive-data":withCtx(({row})=>[createBaseVNode("span",_hoisted_23,toDisplayString(formatRelativeTime(row.lastActive)),1)]),"actions-data":withCtx(({row})=>[createBaseVNode("div",_hoisted_24,[row.mappedUserId?(openBlock(),createBlock(_component_UButton,{key:1,icon:"i-heroicons-link-slash",size:"xs",color:"error",variant:"ghost",onClick:__name($event=>unmapUser(row),"onClick")},null,8,["onClick"])):(openBlock(),createBlock(_component_UButton,{key:0,icon:"i-heroicons-link",size:"xs",variant:"soft",onClick:__name($event=>mapUser(row),"onClick")},{default:withCtx(()=>_cache[19]||(_cache[19]=[createTextVNode(" Map ",-1)])),_:2,__:[19]},1032,["onClick"])),createVNode(_component_UDropdownMenu,{items:getActionItems(row)},{default:withCtx(()=>[createVNode(_component_UButton,{icon:"i-heroicons-ellipsis-vertical",size:"xs",variant:"ghost"})]),_:2},1032,["items"])])]),_:1},8,["rows","loading"]),createBaseVNode("div",_hoisted_25,[createBaseVNode("p",_hoisted_26," Showing "+toDisplayString(unref(startIndex)+1)+" to "+toDisplayString(unref(endIndex))+" of "+toDisplayString(unref(filteredUsers).length)+" users ",1),createVNode(_component_UPagination,{modelValue:unref(page),"onUpdate:modelValue":_cache[3]||(_cache[3]=$event=>isRef(page)?page.value=$event:null),"page-count":pageSize,total:unref(filteredUsers).length},null,8,["modelValue","total"])])]),_:1}),createVNode(unref(_sfc_main$2),{modelValue:unref(showMapModal),"onUpdate:modelValue":_cache[9]||(_cache[9]=$event=>isRef(showMapModal)?showMapModal.value=$event:null)},{default:withCtx(()=>[unref(selectedUser)?(openBlock(),createBlock(_component_UCard,{key:0},{header:withCtx(()=>_cache[20]||(_cache[20]=[createBaseVNode("h3",{class:"text-lg font-semibold"},"Map Slack User",-1)])),default:withCtx(()=>[createBaseVNode("div",_hoisted_27,[createBaseVNode("div",_hoisted_28,[createVNode(_component_UAvatar,{src:unref(selectedUser).avatar,alt:unref(selectedUser).displayName},null,8,["src","alt"]),createBaseVNode("div",null,[createBaseVNode("p",_hoisted_29,toDisplayString(unref(selectedUser).displayName),1),createBaseVNode("p",_hoisted_30,toDisplayString(unref(selectedUser).email),1)])]),createVNode(_component_UFormField,{label:"Map to User",required:""},{default:withCtx(()=>[createVNode(_component_USelectMenu,{modelValue:unref(mappingForm).userId,"onUpdate:modelValue":_cache[4]||(_cache[4]=$event=>unref(mappingForm).userId=$event),options:unref(systemUsers),"option-attribute":"label","value-attribute":"value",placeholder:"Select a user"},null,8,["modelValue","options"])]),_:1}),createVNode(_component_UFormField,{label:"Permissions"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_31,[createVNode(_component_UCheckbox,{modelValue:unref(mappingForm).canRead,"onUpdate:modelValue":_cache[5]||(_cache[5]=$event=>unref(mappingForm).canRead=$event),label:"Can read messages"},null,8,["modelValue"]),createVNode(_component_UCheckbox,{modelValue:unref(mappingForm).canWrite,"onUpdate:modelValue":_cache[6]||(_cache[6]=$event=>unref(mappingForm).canWrite=$event),label:"Can send messages"},null,8,["modelValue"]),createVNode(_component_UCheckbox,{modelValue:unref(mappingForm).canManage,"onUpdate:modelValue":_cache[7]||(_cache[7]=$event=>unref(mappingForm).canManage=$event),label:"Can manage workspace"},null,8,["modelValue"])])]),_:1}),createBaseVNode("div",_hoisted_32,[createVNode(_component_UButton,{variant:"ghost",onClick:_cache[8]||(_cache[8]=$event=>showMapModal.value=!1)},{default:withCtx(()=>_cache[21]||(_cache[21]=[createTextVNode(" Cancel ",-1)])),_:1,__:[21]}),createVNode(_component_UButton,{onClick:saveMapping,loading:unref(isSaving)},{default:withCtx(()=>_cache[22]||(_cache[22]=[createTextVNode(" Map User ",-1)])),_:1,__:[22]},8,["loading"])])])]),_:1})):createCommentVNode("",!0)]),_:1},8,["modelValue"])]),_:1})])}}});export{_sfc_main as default};
