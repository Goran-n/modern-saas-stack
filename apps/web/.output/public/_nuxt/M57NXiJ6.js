var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,"name",{value,configurable:!0});import{u as useCommunicationStore}from"./BvRDyO_j.js";import{e as useTenantStore,i as useSeoMeta,n as navigateTo}from"./BGn8T2aB.js";import{_ as _sfc_main$3}from"./CEfzLdwR.js";import{_ as _sfc_main$4}from"./BeaoTUGu.js";import{_ as _sfc_main$1}from"./B8fQSm5j.js";import{_ as _sfc_main$2}from"./DUt60K_l.js";import{u as useNotification}from"./Dr_osDAG.js";import{z as defineComponent,f as ref,E as computed,A as onMounted,O as createElementBlock,X as createVNode,W as withCtx,G as unref,a7 as resolveComponent,P as openBlock,a2 as createBaseVNode,V as createBlock,a4 as createTextVNode,a3 as toDisplayString,L as Fragment,a8 as renderList,d as isRef,a5 as createCommentVNode}from"./BRSJK7Xo.js";import"./Cw4ufSzG.js";import"./BzzzcPO6.js";import"./BzjSxxHY.js";import"./DOQLo0N3.js";import"./B8R4opHw.js";import"./DIbFRL3M.js";import"./LqpTdS2-.js";const _hoisted_1={class:"min-h-screen bg-neutral-50"},_hoisted_2={class:"mb-6"},_hoisted_3={class:"flex items-center justify-between"},_hoisted_4={class:"flex items-center gap-3"},_hoisted_5={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},_hoisted_6={class:"text-center"},_hoisted_7={class:"text-2xl font-semibold text-gray-900"},_hoisted_8={class:"text-center"},_hoisted_9={class:"text-2xl font-semibold text-green-600"},_hoisted_10={class:"text-center"},_hoisted_11={class:"text-2xl font-semibold text-gray-900"},_hoisted_12={class:"text-center"},_hoisted_13={class:"text-2xl font-semibold text-gray-900"},_hoisted_14={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},_hoisted_15={class:"flex items-center justify-between"},_hoisted_16={class:"flex items-center gap-3"},_hoisted_17={class:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center"},_hoisted_18={class:"font-semibold text-gray-900"},_hoisted_19={class:"text-xs text-gray-500"},_hoisted_20={class:"space-y-3"},_hoisted_21={class:"flex items-center justify-between text-sm"},_hoisted_22={class:"font-medium"},_hoisted_23={class:"flex items-center justify-between text-sm"},_hoisted_24={class:"font-medium"},_hoisted_25={class:"flex items-center justify-between text-sm"},_hoisted_26={class:"font-mono text-xs"},_hoisted_27={class:"flex items-center justify-between text-sm"},_hoisted_28={class:"text-xs"},_hoisted_29={class:"flex items-center gap-2"},_hoisted_30={class:"text-center py-12"},_hoisted_31={class:"w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4"},_hoisted_32={class:"flex justify-end gap-3 pt-4"},_hoisted_33={class:"text-lg font-semibold"},_hoisted_34={class:"space-y-4 mt-4"},_hoisted_35={class:"flex justify-end gap-3 pt-4"},_hoisted_36={class:"mt-4"},_hoisted_37={class:"mb-4"},_hoisted_38={class:"space-y-2"},_hoisted_39={class:"flex items-center gap-2"},_hoisted_40={class:"font-medium"},_hoisted_41={class:"space-y-4 mt-4"},_hoisted_42={class:"flex justify-end gap-3 pt-4"},_sfc_main=defineComponent({__name:"workspaces",setup(__props){const communicationStore=useCommunicationStore(),tenantStore=useTenantStore(),isLoading=ref(!1),isRefreshing=ref(!1),isSubmitting=ref(!1),isUpdating=ref(!1),showAddModal=ref(!1),showConfigModal=ref(!1),selectedWorkspace=ref(null),channelSearch=ref(""),newWorkspace=ref({workspaceId:"",workspaceName:"",botToken:"",botUserId:""}),configForm=ref({workspaceName:"",botToken:"",autoReply:!1,processFiles:!0,retention:"30"}),channels=ref([]),retentionOptions=[{label:"7 days",value:"7"},{label:"30 days",value:"30"},{label:"90 days",value:"90"},{label:"1 year",value:"365"},{label:"Forever",value:"forever"}],configTabs=[{label:"General",slot:"general"},{label:"Channels",slot:"channels"},{label:"Settings",slot:"settings"}],workspaces=computed(()=>communicationStore.workspaces),activeCount=computed(()=>workspaces.value.filter(w=>w.botToken).length),totalUsers=computed(()=>workspaces.value.reduce((sum,w)=>sum+(w.userCount||0),0)),totalChannels=computed(()=>workspaces.value.reduce((sum,w)=>sum+(w.channelCount||0),0)),filteredChannels=computed(()=>channels.value.filter(c=>c.name.toLowerCase().includes(channelSearch.value.toLowerCase()))),breadcrumbs=[{label:"Communications",to:"/communications"},{label:"Slack",to:"/communications/slack"},{label:"Workspaces"}];onMounted(async()=>{if(tenantStore.selectedTenantId||await tenantStore.fetchUserTenants(),!tenantStore.selectedTenantId){useNotification().error("No tenant selected","Please select a tenant to view workspaces.");return}isLoading.value=!0;try{await communicationStore.fetchWorkspaces()}catch{useNotification().error("Failed to load workspaces","Unable to load workspace data. Please try again.")}finally{isLoading.value=!1}});const refresh=__name(async()=>{isRefreshing.value=!0;try{await communicationStore.fetchWorkspaces(),useNotification().success("Data refreshed")}catch{useNotification().error("Failed to refresh data","The backend API is not available.")}finally{isRefreshing.value=!1}},"refresh"),connectWorkspace=__name(async()=>{isSubmitting.value=!0;try{await new Promise(resolve=>setTimeout(resolve,1e3)),useNotification().success("Workspace connected","Slack workspace has been connected successfully"),showAddModal.value=!1,newWorkspace.value={workspaceId:"",workspaceName:"",botToken:"",botUserId:""},await refresh()}catch{useNotification().error("Connection failed","Could not connect to Slack workspace")}finally{isSubmitting.value=!1}},"connectWorkspace"),configureWorkspace=__name(workspace=>{selectedWorkspace.value=workspace,configForm.value={workspaceName:workspace.workspaceName||"",botToken:workspace.botToken,autoReply:!1,processFiles:!0,retention:"30"},showConfigModal.value=!0},"configureWorkspace"),viewUsers=__name(workspace=>{navigateTo(`/communications/slack/users?workspace=${workspace.id}`)},"viewUsers"),disconnectWorkspace=__name(async workspace=>{if(confirm(`Are you sure you want to disconnect ${workspace.workspaceName||"this workspace"}?`))try{await new Promise(resolve=>setTimeout(resolve,500)),useNotification().success("Workspace disconnected","The Slack workspace has been disconnected"),await refresh()}catch{useNotification().error("Disconnection failed","Could not disconnect the workspace")}},"disconnectWorkspace"),updateConfiguration=__name(async()=>{isUpdating.value=!0;try{await new Promise(resolve=>setTimeout(resolve,1e3)),useNotification().success("Configuration updated","Workspace configuration has been updated"),showConfigModal.value=!1,await refresh()}catch{useNotification().error("Update failed","Could not update workspace configuration")}finally{isUpdating.value=!1}},"updateConfiguration"),updateSettings=__name(async()=>{isUpdating.value=!0;try{await new Promise(resolve=>setTimeout(resolve,1e3)),useNotification().success("Settings updated","Workspace settings have been updated"),showConfigModal.value=!1}catch{useNotification().error("Update failed","Could not update workspace settings")}finally{isUpdating.value=!1}},"updateSettings"),formatDate=__name(date=>new Date(date).toLocaleDateString(),"formatDate");return useSeoMeta({title:"Slack Workspaces | Figgy",description:"Manage connected Slack workspaces and their configurations"}),(_ctx,_cache)=>{const _component_UBreadcrumb=resolveComponent("UBreadcrumb"),_component_UButton=resolveComponent("UButton"),_component_UCard=resolveComponent("UCard"),_component_UIcon=resolveComponent("UIcon"),_component_UInput=resolveComponent("UInput"),_component_UFormGroup=resolveComponent("UFormGroup"),_component_UAlert=resolveComponent("UAlert"),_component_UForm=resolveComponent("UForm"),_component_UToggle=resolveComponent("UToggle"),_component_USelectMenu=resolveComponent("USelectMenu"),_component_UTabs=resolveComponent("UTabs");return openBlock(),createElementBlock("div",_hoisted_1,[createVNode(unref(_sfc_main$4),{"max-width":"6xl",class:"py-8"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_2,[createVNode(_component_UBreadcrumb,{links:breadcrumbs,class:"mb-4"}),createBaseVNode("div",_hoisted_3,[_cache[19]||(_cache[19]=createBaseVNode("div",null,[createBaseVNode("h1",{class:"text-2xl font-semibold text-gray-900"},"Slack Workspaces"),createBaseVNode("p",{class:"mt-1 text-sm text-gray-600"}," Manage connected Slack workspaces and their configurations ")],-1)),createBaseVNode("div",_hoisted_4,[createVNode(_component_UButton,{icon:"i-heroicons-arrow-path",variant:"soft",onClick:refresh,loading:unref(isRefreshing)},{default:withCtx(()=>_cache[17]||(_cache[17]=[createTextVNode(" Refresh ",-1)])),_:1,__:[17]},8,["loading"]),createVNode(_component_UButton,{icon:"i-heroicons-plus",onClick:_cache[0]||(_cache[0]=$event=>showAddModal.value=!0)},{default:withCtx(()=>_cache[18]||(_cache[18]=[createTextVNode(" Connect Workspace ",-1)])),_:1,__:[18]})])])]),createBaseVNode("div",_hoisted_5,[createVNode(_component_UCard,null,{default:withCtx(()=>[createBaseVNode("div",_hoisted_6,[createBaseVNode("p",_hoisted_7,toDisplayString(unref(workspaces).length),1),_cache[20]||(_cache[20]=createBaseVNode("p",{class:"text-sm text-gray-600 mt-1"},"Total Workspaces",-1))])]),_:1}),createVNode(_component_UCard,null,{default:withCtx(()=>[createBaseVNode("div",_hoisted_8,[createBaseVNode("p",_hoisted_9,toDisplayString(unref(activeCount)),1),_cache[21]||(_cache[21]=createBaseVNode("p",{class:"text-sm text-gray-600 mt-1"},"Active",-1))])]),_:1}),createVNode(_component_UCard,null,{default:withCtx(()=>[createBaseVNode("div",_hoisted_10,[createBaseVNode("p",_hoisted_11,toDisplayString(unref(totalUsers)),1),_cache[22]||(_cache[22]=createBaseVNode("p",{class:"text-sm text-gray-600 mt-1"},"Total Users",-1))])]),_:1}),createVNode(_component_UCard,null,{default:withCtx(()=>[createBaseVNode("div",_hoisted_12,[createBaseVNode("p",_hoisted_13,toDisplayString(unref(totalChannels)),1),_cache[23]||(_cache[23]=createBaseVNode("p",{class:"text-sm text-gray-600 mt-1"},"Total Channels",-1))])]),_:1})]),unref(workspaces).length>0?(openBlock(),createElementBlock("div",_hoisted_14,[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(workspaces),workspace=>(openBlock(),createBlock(_component_UCard,{key:workspace.id,class:"hover:shadow-lg transition-shadow"},{header:withCtx(()=>[createBaseVNode("div",_hoisted_15,[createBaseVNode("div",_hoisted_16,[createBaseVNode("div",_hoisted_17,[createVNode(_component_UIcon,{name:"i-simple-icons-slack",class:"w-6 h-6 text-purple-600"})]),createBaseVNode("div",null,[createBaseVNode("h3",_hoisted_18,toDisplayString(workspace.workspaceName||"Unnamed Workspace"),1),createBaseVNode("p",_hoisted_19,"ID: "+toDisplayString(workspace.workspaceId),1)])]),createVNode(unref(_sfc_main$1),{status:workspace.botToken?"active":"inactive",type:"connection",variant:"soft",size:"xs"},null,8,["status"])])]),footer:withCtx(()=>[createBaseVNode("div",_hoisted_29,[createVNode(_component_UButton,{size:"sm",variant:"soft",icon:"i-heroicons-cog-6-tooth",onClick:__name($event=>configureWorkspace(workspace),"onClick")},{default:withCtx(()=>_cache[28]||(_cache[28]=[createTextVNode(" Configure ",-1)])),_:2,__:[28]},1032,["onClick"]),createVNode(_component_UButton,{size:"sm",variant:"soft",icon:"i-heroicons-users",onClick:__name($event=>viewUsers(workspace),"onClick")},{default:withCtx(()=>_cache[29]||(_cache[29]=[createTextVNode(" Users ",-1)])),_:2,__:[29]},1032,["onClick"]),createVNode(_component_UButton,{size:"sm",color:"error",variant:"ghost",icon:"i-heroicons-trash",onClick:__name($event=>disconnectWorkspace(workspace),"onClick")},null,8,["onClick"])])]),default:withCtx(()=>[createBaseVNode("div",_hoisted_20,[createBaseVNode("div",_hoisted_21,[_cache[24]||(_cache[24]=createBaseVNode("span",{class:"text-gray-600"},"Users",-1)),createBaseVNode("span",_hoisted_22,toDisplayString(workspace.userCount||0),1)]),createBaseVNode("div",_hoisted_23,[_cache[25]||(_cache[25]=createBaseVNode("span",{class:"text-gray-600"},"Channels",-1)),createBaseVNode("span",_hoisted_24,toDisplayString(workspace.channelCount||0),1)]),createBaseVNode("div",_hoisted_25,[_cache[26]||(_cache[26]=createBaseVNode("span",{class:"text-gray-600"},"Bot User ID",-1)),createBaseVNode("span",_hoisted_26,toDisplayString(workspace.botUserId),1)]),createBaseVNode("div",_hoisted_27,[_cache[27]||(_cache[27]=createBaseVNode("span",{class:"text-gray-600"},"Connected",-1)),createBaseVNode("span",_hoisted_28,toDisplayString(formatDate(workspace.createdAt)),1)])])]),_:2},1024))),128))])):(openBlock(),createBlock(_component_UCard,{key:1},{default:withCtx(()=>[createBaseVNode("div",_hoisted_30,[createBaseVNode("div",_hoisted_31,[createVNode(_component_UIcon,{name:"i-simple-icons-slack",class:"w-8 h-8 text-purple-600"})]),_cache[31]||(_cache[31]=createBaseVNode("h3",{class:"text-lg font-semibold text-gray-900 mb-2"},"No Slack workspaces connected",-1)),_cache[32]||(_cache[32]=createBaseVNode("p",{class:"text-sm text-gray-600 mb-6"}," Connect your first Slack workspace to start processing messages ",-1)),createVNode(_component_UButton,{icon:"i-heroicons-plus",onClick:_cache[1]||(_cache[1]=$event=>showAddModal.value=!0)},{default:withCtx(()=>_cache[30]||(_cache[30]=[createTextVNode(" Connect Workspace ",-1)])),_:1,__:[30]})])]),_:1})),createVNode(unref(_sfc_main$2),{modelValue:unref(showAddModal),"onUpdate:modelValue":_cache[7]||(_cache[7]=$event=>isRef(showAddModal)?showAddModal.value=$event:null)},{default:withCtx(()=>[createVNode(_component_UCard,null,{header:withCtx(()=>_cache[33]||(_cache[33]=[createBaseVNode("h3",{class:"text-lg font-semibold"},"Connect Slack Workspace",-1)])),default:withCtx(()=>[createVNode(_component_UForm,{state:unref(newWorkspace),onSubmit:connectWorkspace,class:"space-y-4"},{default:withCtx(()=>[createVNode(_component_UFormGroup,{label:"Workspace ID",required:""},{default:withCtx(()=>[createVNode(_component_UInput,{modelValue:unref(newWorkspace).workspaceId,"onUpdate:modelValue":_cache[2]||(_cache[2]=$event=>unref(newWorkspace).workspaceId=$event),placeholder:"T1234567890",icon:"i-heroicons-building-office"},null,8,["modelValue"])]),_:1}),createVNode(_component_UFormGroup,{label:"Bot Token",required:""},{default:withCtx(()=>[createVNode(_component_UInput,{modelValue:unref(newWorkspace).botToken,"onUpdate:modelValue":_cache[3]||(_cache[3]=$event=>unref(newWorkspace).botToken=$event),type:"password",placeholder:"xoxb-...",icon:"i-heroicons-key"},null,8,["modelValue"])]),_:1}),createVNode(_component_UFormGroup,{label:"Bot User ID",required:""},{default:withCtx(()=>[createVNode(_component_UInput,{modelValue:unref(newWorkspace).botUserId,"onUpdate:modelValue":_cache[4]||(_cache[4]=$event=>unref(newWorkspace).botUserId=$event),placeholder:"U1234567890",icon:"i-heroicons-user"},null,8,["modelValue"])]),_:1}),createVNode(_component_UFormGroup,{label:"Workspace Name",help:"Optional - will be fetched automatically"},{default:withCtx(()=>[createVNode(_component_UInput,{modelValue:unref(newWorkspace).workspaceName,"onUpdate:modelValue":_cache[5]||(_cache[5]=$event=>unref(newWorkspace).workspaceName=$event),placeholder:"My Workspace",icon:"i-heroicons-tag"},null,8,["modelValue"])]),_:1}),createVNode(_component_UAlert,{icon:"i-heroicons-information-circle",color:"info",variant:"soft",title:"How to get these values",description:"Visit your Slack app settings at api.slack.com to find your bot token and IDs"}),createBaseVNode("div",_hoisted_32,[createVNode(_component_UButton,{variant:"ghost",onClick:_cache[6]||(_cache[6]=$event=>showAddModal.value=!1)},{default:withCtx(()=>_cache[34]||(_cache[34]=[createTextVNode(" Cancel ",-1)])),_:1,__:[34]}),createVNode(_component_UButton,{type:"submit",loading:unref(isSubmitting)},{default:withCtx(()=>_cache[35]||(_cache[35]=[createTextVNode(" Connect Workspace ",-1)])),_:1,__:[35]},8,["loading"])])]),_:1},8,["state"])]),_:1})]),_:1},8,["modelValue"]),createVNode(unref(_sfc_main$2),{modelValue:unref(showConfigModal),"onUpdate:modelValue":_cache[16]||(_cache[16]=$event=>isRef(showConfigModal)?showConfigModal.value=$event:null)},{default:withCtx(()=>[unref(selectedWorkspace)?(openBlock(),createBlock(_component_UCard,{key:0},{header:withCtx(()=>[createBaseVNode("h3",_hoisted_33,"Configure "+toDisplayString(unref(selectedWorkspace).workspaceName||"Workspace"),1)]),default:withCtx(()=>[createVNode(_component_UTabs,{items:configTabs,class:"mt-4"},{general:withCtx(()=>[createBaseVNode("div",_hoisted_34,[createVNode(_component_UFormGroup,{label:"Workspace Name"},{default:withCtx(()=>[createVNode(_component_UInput,{modelValue:unref(configForm).workspaceName,"onUpdate:modelValue":_cache[8]||(_cache[8]=$event=>unref(configForm).workspaceName=$event),placeholder:"Workspace name"},null,8,["modelValue"])]),_:1}),createVNode(_component_UFormGroup,{label:"Bot Token"},{default:withCtx(()=>[createVNode(_component_UInput,{modelValue:unref(configForm).botToken,"onUpdate:modelValue":_cache[9]||(_cache[9]=$event=>unref(configForm).botToken=$event),type:"password",placeholder:"xoxb-..."},null,8,["modelValue"])]),_:1}),createVNode(_component_UFormGroup,{label:"Status"},{default:withCtx(()=>[createVNode(unref(_sfc_main$1),{status:unref(selectedWorkspace).botToken?"active":"inactive",type:"connection",variant:"soft",size:"sm"},null,8,["status"])]),_:1}),createBaseVNode("div",_hoisted_35,[createVNode(_component_UButton,{variant:"ghost",onClick:_cache[10]||(_cache[10]=$event=>showConfigModal.value=!1)},{default:withCtx(()=>_cache[36]||(_cache[36]=[createTextVNode(" Cancel ",-1)])),_:1,__:[36]}),createVNode(_component_UButton,{onClick:updateConfiguration,loading:unref(isUpdating)},{default:withCtx(()=>_cache[37]||(_cache[37]=[createTextVNode(" Save Changes ",-1)])),_:1,__:[37]},8,["loading"])])])]),channels:withCtx(()=>[createBaseVNode("div",_hoisted_36,[createBaseVNode("div",_hoisted_37,[createVNode(_component_UInput,{modelValue:unref(channelSearch),"onUpdate:modelValue":_cache[11]||(_cache[11]=$event=>isRef(channelSearch)?channelSearch.value=$event:null),placeholder:"Search channels...",icon:"i-heroicons-magnifying-glass"},null,8,["modelValue"])]),createBaseVNode("div",_hoisted_38,[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(filteredChannels),channel=>(openBlock(),createElementBlock("div",{key:channel.id,class:"flex items-center justify-between p-3 rounded-lg hover:bg-gray-50"},[createBaseVNode("div",_hoisted_39,[createVNode(_component_UIcon,{name:"i-heroicons-hashtag",class:"text-gray-400"}),createBaseVNode("span",_hoisted_40,toDisplayString(channel.name),1),channel.isPrivate?(openBlock(),createBlock(unref(_sfc_main$3),{key:0,size:"xs",variant:"soft",color:"neutral"},{default:withCtx(()=>_cache[38]||(_cache[38]=[createTextVNode(" Private ",-1)])),_:1,__:[38]})):createCommentVNode("",!0)]),createVNode(_component_UToggle,{modelValue:channel.enabled,"onUpdate:modelValue":__name($event=>channel.enabled=$event,"onUpdate:modelValue")},null,8,["modelValue","onUpdate:modelValue"])]))),128))])])]),settings:withCtx(()=>[createBaseVNode("div",_hoisted_41,[createVNode(_component_UFormGroup,{label:"Auto-Reply"},{help:withCtx(()=>_cache[39]||(_cache[39]=[createTextVNode(" Automatically reply to messages when mentioned ",-1)])),default:withCtx(()=>[createVNode(_component_UToggle,{modelValue:unref(configForm).autoReply,"onUpdate:modelValue":_cache[12]||(_cache[12]=$event=>unref(configForm).autoReply=$event)},null,8,["modelValue"])]),_:1}),createVNode(_component_UFormGroup,{label:"Process Files"},{help:withCtx(()=>_cache[40]||(_cache[40]=[createTextVNode(" Process files shared in channels ",-1)])),default:withCtx(()=>[createVNode(_component_UToggle,{modelValue:unref(configForm).processFiles,"onUpdate:modelValue":_cache[13]||(_cache[13]=$event=>unref(configForm).processFiles=$event)},null,8,["modelValue"])]),_:1}),createVNode(_component_UFormGroup,{label:"Message Retention"},{default:withCtx(()=>[createVNode(_component_USelectMenu,{modelValue:unref(configForm).retention,"onUpdate:modelValue":_cache[14]||(_cache[14]=$event=>unref(configForm).retention=$event),options:retentionOptions,placeholder:"Select retention period"},null,8,["modelValue"])]),_:1}),createBaseVNode("div",_hoisted_42,[createVNode(_component_UButton,{variant:"ghost",onClick:_cache[15]||(_cache[15]=$event=>showConfigModal.value=!1)},{default:withCtx(()=>_cache[41]||(_cache[41]=[createTextVNode(" Cancel ",-1)])),_:1,__:[41]}),createVNode(_component_UButton,{onClick:updateSettings,loading:unref(isUpdating)},{default:withCtx(()=>_cache[42]||(_cache[42]=[createTextVNode(" Save Settings ",-1)])),_:1,__:[42]},8,["loading"])])])]),_:1})]),_:1})):createCommentVNode("",!0)]),_:1},8,["modelValue"])]),_:1})])}}});export{_sfc_main as default};
