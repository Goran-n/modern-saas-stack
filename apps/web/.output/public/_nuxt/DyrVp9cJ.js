var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,"name",{value,configurable:!0});import{a as useSupabaseUser,d as useRoute,C as createError,c as useSupabaseClient}from"./BGn8T2aB.js";import{u as useNotifications}from"./BzjSxxHY.js";import{z as defineComponent,f as ref,O as createElementBlock,a2 as createBaseVNode,a9 as createStaticVNode,a3 as toDisplayString,G as unref,X as createVNode,W as withCtx,a7 as resolveComponent,P as openBlock,a4 as createTextVNode}from"./BRSJK7Xo.js";import"./DOQLo0N3.js";const _hoisted_1={class:"space-y-6"},_hoisted_2={class:"text-center"},_hoisted_3={class:"mt-4 p-4 bg-slate-50 rounded-lg"},_hoisted_4={class:"flex items-center justify-center space-x-2"},_hoisted_5={class:"text-sm font-medium text-slate-700"},_hoisted_6={class:"flex space-x-3"},_sfc_main=defineComponent({__name:"extension-consent",setup(__props){const user=useSupabaseUser(),route=useRoute(),{general}=useNotifications(),isLoading=ref(!1),callbackUrl=route.query.callback;if(!callbackUrl||!callbackUrl.startsWith("chrome-extension://"))throw createError({statusCode:400,statusMessage:`Invalid extension callback URL: ${callbackUrl}`});async function handleApprove(){try{isLoading.value=!0;const supabaseClient=useSupabaseClient(),{data:sessionResponse}=await supabaseClient.auth.getSession(),currentSession=sessionResponse?.session;if(!currentSession){general.error("Error","No active session found. Please try again.");return}const sessionData={access_token:currentSession.access_token,refresh_token:currentSession.refresh_token,expires_at:currentSession.expires_at,user:currentSession.user};general.success("Success!","Redirecting to browser extension..."),await new Promise(resolve=>setTimeout(resolve,1e3));try{const authResult={sessionData,timestamp:Date.now(),approved:!0,callbackUrl};window.sessionStorage.setItem("figgy_extension_auth_result",JSON.stringify(authResult)),window.localStorage.setItem("figgy_extension_auth_result",JSON.stringify(authResult))}catch{}general.success("Success!","Authentication approved! You can now close this tab and return to the extension."),setTimeout(()=>{try{window.close()}catch{}},3e3)}catch(error){general.error("Error",error instanceof Error?error.message:"Failed to approve access")}finally{isLoading.value=!1}}__name(handleApprove,"handleApprove");async function handleReject(){try{general.error("Access Denied","Extension access was denied");const redirectUrl=`${callbackUrl}?auth_success=false&error=access_denied&timestamp=${Date.now()}`;window.location.href=redirectUrl}catch{window.close()}}return __name(handleReject,"handleReject"),(_ctx,_cache)=>{const _component_UButton=resolveComponent("UButton");return openBlock(),createElementBlock("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[_cache[1]||(_cache[1]=createStaticVNode('<div class="mx-auto w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-4"><svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div><h1 class="text-2xl font-semibold text-slate-900"> Authorise Browser Extension </h1><p class="mt-2 text-sm text-slate-600"> The Figgy browser extension is requesting access to your account </p>',3)),createBaseVNode("div",_hoisted_3,[createBaseVNode("div",_hoisted_4,[_cache[0]||(_cache[0]=createBaseVNode("div",{class:"w-8 h-8 bg-white rounded border flex items-center justify-center"},[createBaseVNode("svg",{class:"w-5 h-5 text-slate-600",fill:"currentColor",viewBox:"0 0 20 20"},[createBaseVNode("path",{d:"M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"})])],-1)),createBaseVNode("span",_hoisted_5,toDisplayString(unref(user)?.email),1)])])]),_cache[4]||(_cache[4]=createStaticVNode('<div class="bg-blue-50 border border-blue-200 rounded-lg p-4"><h3 class="font-medium text-blue-900 mb-2">Extension Access Permissions</h3><ul class="space-y-2 text-sm text-blue-800"><li class="flex items-center"><svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg> Access your files and documents </li><li class="flex items-center"><svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg> Enable drag-and-drop file transfers to Xero </li><li class="flex items-center"><svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg> Sync authentication with browser extension </li></ul></div>',1)),createBaseVNode("div",_hoisted_6,[createVNode(_component_UButton,{block:"",size:"lg",onClick:handleApprove,loading:unref(isLoading),disabled:unref(isLoading)},{default:withCtx(()=>_cache[2]||(_cache[2]=[createTextVNode(" Approve Access ",-1)])),_:1,__:[2]},8,["loading","disabled"]),createVNode(_component_UButton,{block:"",size:"lg",color:"neutral",variant:"outline",onClick:handleReject,disabled:unref(isLoading)},{default:withCtx(()=>_cache[3]||(_cache[3]=[createTextVNode(" Deny ",-1)])),_:1,__:[3]},8,["disabled"])]),_cache[5]||(_cache[5]=createBaseVNode("p",{class:"text-xs text-center text-slate-500"}," By approving, you allow the Figgy browser extension to access your account on this device. You can revoke this access at any time from your account settings. ",-1))])}}});export{_sfc_main as default};
